<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"github.io","root":"/","images":"/images","scheme":"Gemini","version":"8.6.1","exturl":false,"sidebar":{"position":"right","display":"always","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta name="description" content="喜马拉雅车载版-项目优化点小结">
<meta property="og:type" content="article">
<meta property="og:title" content="喜马拉雅车载版-项目优化点小结">
<meta property="og:url" content="http://mikilangkilo.yin@github.io/2019/09/06/%E5%96%9C%E9%A9%AC%E6%8B%89%E9%9B%85%E8%BD%A6%E8%BD%BD%E7%89%88-%E9%A1%B9%E7%9B%AE%E4%BC%98%E5%8C%96%E7%82%B9%E5%B0%8F%E7%BB%93/index.html">
<meta property="og:site_name" content="个人小站">
<meta property="og:description" content="喜马拉雅车载版-项目优化点小结">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2019-09-06T04:02:37.000Z">
<meta property="article:modified_time" content="2021-07-11T10:31:35.469Z">
<meta property="article:author" content="殷鹏程">
<meta property="article:tag" content="喜马拉雅车载版">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://mikilangkilo.yin@github.io/2019/09/06/%E5%96%9C%E9%A9%AC%E6%8B%89%E9%9B%85%E8%BD%A6%E8%BD%BD%E7%89%88-%E9%A1%B9%E7%9B%AE%E4%BC%98%E5%8C%96%E7%82%B9%E5%B0%8F%E7%BB%93/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://mikilangkilo.yin@github.io/2019/09/06/%E5%96%9C%E9%A9%AC%E6%8B%89%E9%9B%85%E8%BD%A6%E8%BD%BD%E7%89%88-%E9%A1%B9%E7%9B%AE%E4%BC%98%E5%8C%96%E7%82%B9%E5%B0%8F%E7%BB%93/","path":"2019/09/06/喜马拉雅车载版-项目优化点小结/","title":"喜马拉雅车载版-项目优化点小结"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>喜马拉雅车载版-项目优化点小结 | 个人小站</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">个人小站</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">33</span></a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">15</span></a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">108</span></a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%9B%AE%E5%89%8D%E7%9A%84%E7%8E%B0%E7%8A%B6"><span class="nav-number">1.</span> <span class="nav-text">目前的现状</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%95%B4%E7%90%86%E7%9A%84%E4%BC%98%E5%8C%96%E7%82%B9"><span class="nav-number">2.</span> <span class="nav-text">整理的优化点</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#recyclerview"><span class="nav-number">2.1.</span> <span class="nav-text">recyclerview</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E9%A2%84%E5%8A%A0%E8%BD%BD"><span class="nav-number">2.1.1.</span> <span class="nav-text">数据预加载</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#getExtraLayoutSpace"><span class="nav-number">2.1.1.1.</span> <span class="nav-text">getExtraLayoutSpace</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%8D%E7%94%A8%E6%80%A7%E6%8F%90%E5%8D%87"><span class="nav-number">2.1.2.</span> <span class="nav-text">复用性提升</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#setItemViewCacheSize"><span class="nav-number">2.1.2.1.</span> <span class="nav-text">setItemViewCacheSize</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#setItemPrefetchEnabled-true"><span class="nav-number">2.1.2.2.</span> <span class="nav-text">setItemPrefetchEnabled(true)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#setSupportsChangeAnimations-false"><span class="nav-number">2.1.2.3.</span> <span class="nav-text">setSupportsChangeAnimations(false)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%8D%E7%94%A8%E6%80%A7%E7%A9%B6%E6%9E%81%E6%8F%90%E5%8D%87%EF%BC%8C%E5%A4%8D%E5%86%99RecyclerView-onViewRecycled-holder"><span class="nav-number">2.1.2.4.</span> <span class="nav-text">复用性究极提升，复写RecyclerView.onViewRecycled(holder)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%99%8D%E4%BD%8E%E7%BB%98%E5%88%B6"><span class="nav-number">2.1.3.</span> <span class="nav-text">降低绘制</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A1%AB%E5%85%85%E6%95%B0%E6%8D%AE%E6%97%B6%E4%BD%BF%E7%94%A8notifyItemXXX%E8%80%8C%E9%9D%9EnotifyDataSetChanged"><span class="nav-number">2.1.3.1.</span> <span class="nav-text">填充数据时使用notifyItemXXX而非notifyDataSetChanged</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#setHasFixedSize-true"><span class="nav-number">2.1.3.2.</span> <span class="nav-text">setHasFixedSize(true)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%92%88%E5%AF%B94-2%E8%BD%A6%E6%9C%BA%E7%9A%84%E4%BC%98%E5%8C%96"><span class="nav-number">2.1.4.</span> <span class="nav-text">针对4.2车机的优化</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%83%E5%B1%80%E4%BC%98%E5%8C%96"><span class="nav-number">2.2.</span> <span class="nav-text">布局优化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8constraintlayout"><span class="nav-number">2.2.1.</span> <span class="nav-text">使用constraintlayout</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#group%EF%BC%9A%E6%9B%BF%E4%BB%A3contaier%E7%9A%84%E6%95%88%E6%9E%9C%EF%BC%8C%E6%93%8D%E4%BD%9C%E4%B8%80%E4%B8%AAgroup%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%B0%86%E5%BE%88%E5%A4%9A%E8%A7%86%E5%9B%BE%E7%9A%84%E5%8F%AF%E8%A7%81%E6%80%A7%E7%BB%91%E5%AE%9A%E8%B5%B7%E6%9D%A5%E8%BF%9B%E8%A1%8C%E6%8E%A7%E5%88%B6"><span class="nav-number">2.2.1.1.</span> <span class="nav-text">group：替代contaier的效果，操作一个group，可以将很多视图的可见性绑定起来进行控制</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#constraintDimensionRatio%EF%BC%9A%E5%8F%AF%E4%BB%A5%E8%87%AA%E7%94%B1%E7%9A%84%E6%93%8D%E4%BD%9C%E5%AE%BD%E9%AB%98%E6%AF%94%E4%BE%8B"><span class="nav-number">2.2.1.2.</span> <span class="nav-text">constraintDimensionRatio：可以自由的操作宽高比例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#chain-%E6%9B%BF%E4%BB%A3weight%EF%BC%8Cspace%EF%BC%8C%E5%B0%86%E5%87%A0%E4%B8%AAview%E7%BB%84%E5%90%88%E8%B5%B7%E6%9D%A5%E5%B9%B3%E5%88%86%E6%88%96%E8%80%85%E6%8C%89%E6%AF%94%E4%BE%8B%E5%88%86%E9%85%8D%E7%AB%96%E7%9B%B4%E6%88%96%E8%80%85%E6%A8%AA%E5%90%91%E7%9A%84%E7%A9%BA%E9%97%B4"><span class="nav-number">2.2.1.3.</span> <span class="nav-text">chain:替代weight，space，将几个view组合起来平分或者按比例分配竖直或者横向的空间</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#goneMargin-%E8%A7%86%E5%9B%BE%E5%B1%9E%E6%80%A7%E4%B8%BAgone%E6%97%B6%EF%BC%8C%E4%BB%A5%E8%87%AA%E5%B7%B1%E4%B8%BA%E5%9D%90%E6%A0%87%E7%9A%84%E8%A7%86%E5%9B%BE%E4%BC%9A%E9%A2%9D%E5%A4%96%E6%8B%A5%E6%9C%89%E7%9A%84margin%E8%BE%B9%E8%B7%9D"><span class="nav-number">2.2.1.4.</span> <span class="nav-text">goneMargin:视图属性为gone时，以自己为坐标的视图会额外拥有的margin边距</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#textview%E8%AE%BE%E7%BD%AE%E5%AE%BD%E5%BA%A6%E4%B8%BA0dp%EF%BC%8C%E7%84%B6%E5%90%8E%E8%AE%BE%E7%BD%AE%E5%A5%BDstartof%E5%92%8Cendof%EF%BC%8C%E5%8D%B3%E5%8F%AF%E5%85%85%E8%B6%B3%E5%88%A9%E7%94%A8%E4%B8%80%E6%AE%B5%E7%A9%BA%E9%97%B4%EF%BC%8C%E5%B9%B6%E4%B8%94%E4%BB%8E%E5%A4%B4%E5%BC%80%E5%A7%8B%E6%8E%92%E5%B8%83"><span class="nav-number">2.2.1.5.</span> <span class="nav-text">textview设置宽度为0dp，然后设置好startof和endof，即可充足利用一段空间，并且从头开始排布</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#include%E5%92%8Cmerge%E6%A0%87%E7%AD%BE%E5%85%B1%E7%94%A8"><span class="nav-number">2.2.2.</span> <span class="nav-text">include和merge标签共用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8viewstub"><span class="nav-number">2.2.3.</span> <span class="nav-text">使用viewstub</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%BB%E9%99%A4%E8%83%8C%E6%99%AF"><span class="nav-number">2.2.4.</span> <span class="nav-text">去除背景</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%83%A8%E5%88%86%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%E6%93%8D%E4%BD%9C"><span class="nav-number">3.</span> <span class="nav-text">部分工具使用操作</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A3%80%E6%B5%8Bapp%E5%90%AF%E5%8A%A8%E6%96%B9%E6%B3%95%E8%80%97%E6%97%B6"><span class="nav-number">3.1.</span> <span class="nav-text">检测app启动方法耗时</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">殷鹏程</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">108</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags">
          
        <span class="site-state-item-count">33</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/mikilangkilo" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;mikilangkilo" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:913925047@qq.com" title="E-Mail → mailto:913925047@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



          </div>
        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/mikilangkilo" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://mikilangkilo.yin@github.io/2019/09/06/%E5%96%9C%E9%A9%AC%E6%8B%89%E9%9B%85%E8%BD%A6%E8%BD%BD%E7%89%88-%E9%A1%B9%E7%9B%AE%E4%BC%98%E5%8C%96%E7%82%B9%E5%B0%8F%E7%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="殷鹏程">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人小站">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          喜马拉雅车载版-项目优化点小结
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-09-06 12:02:37" itemprop="dateCreated datePublished" datetime="2019-09-06T12:02:37+08:00">2019-09-06</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-11 18:31:35" itemprop="dateModified" datetime="2021-07-11T18:31:35+08:00">2021-07-11</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E4%BC%98%E5%8C%96/" itemprop="url" rel="index"><span itemprop="name">优化</span></a>
        </span>
    </span>

  
</div>

            <div class="post-description">喜马拉雅车载版-项目优化点小结</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="目前的现状"><a href="#目前的现状" class="headerlink" title="目前的现状"></a>目前的现状</h1><p>app在低版本上面卡顿比较明显，掉帧严重，布局嵌套严重<br>酷我的app业务层开始是第4层，平均ui显示在第7-11层，我们的app从第8层开始展现业务，平均层级在14-18层<br>酷我的车机执行滑动时绘制时间平均为500ms，我们的app绘制时间平均为800多ms（仅从主页来讲）</p>
<p>因此将部分在长安车机上面验证的优化点列下来，之后组内性能优化的时候可以有个参照，另外也附注了部分源码级别的解释，大家可以看看优化的原理，如果有不同的也可以讨论讨论。此文档长期维护，优化点会逐渐增加。</p>
<p>优化指标主要这几个方面：cpu占用率、内存占用、帧率、电量、流量、过度绘制、包大小、启动时间、crash率</p>
<h1 id="整理的优化点"><a href="#整理的优化点" class="headerlink" title="整理的优化点"></a>整理的优化点</h1><h2 id="recyclerview"><a href="#recyclerview" class="headerlink" title="recyclerview"></a>recyclerview</h2><p>recyclerview的优化主要在数据预加载、复用性提升、降低绘制次数上面做文章，其中复用性的提升亦会带来绘制次数的降低</p>
<h3 id="数据预加载"><a href="#数据预加载" class="headerlink" title="数据预加载"></a>数据预加载</h3><h4 id="getExtraLayoutSpace"><a href="#getExtraLayoutSpace" class="headerlink" title="getExtraLayoutSpace"></a>getExtraLayoutSpace</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">LinearLayoutManager linearLayoutManager = new LinearLayoutManager(getContext(), LinearLayoutManager.HORIZONTAL, false)&#123;</span><br><span class="line">           @Override</span><br><span class="line">           protected int getExtraLayoutSpace(RecyclerView.State state) &#123;</span><br><span class="line">               return 10000;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;;</span><br></pre></td></tr></table></figure>
<p>初始化recyclerview的layoutmanager的时候，通过复写getextralayoutspace，可以通过增加绘制时间，来提前加载不可见区域的视图</p>
<p>其原理主要是在layoutmanager.onLayoutChildren-&gt;fill()中执行的下面这段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">while((layoutState.mInfinite || remainingSpace &gt; 0) &amp;&amp; layoutState.hasMore(state)) &#123;</span><br><span class="line">     layoutChunkResult.resetInternal();</span><br><span class="line">     this.layoutChunk(recycler, state, layoutState, layoutChunkResult);</span><br><span class="line">     if (layoutChunkResult.mFinished) &#123;</span><br><span class="line">       break;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     layoutState.mOffset += layoutChunkResult.mConsumed * layoutState.mLayoutDirection;</span><br><span class="line">     if (!layoutChunkResult.mIgnoreConsumed || this.mLayoutState.mScrapList != null || !state.isPreLayout()) &#123;</span><br><span class="line">       layoutState.mAvailable -= layoutChunkResult.mConsumed;</span><br><span class="line">       remainingSpace -= layoutChunkResult.mConsumed;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     if (layoutState.mScrollingOffset != -2147483648) &#123;</span><br><span class="line">       layoutState.mScrollingOffset += layoutChunkResult.mConsumed;</span><br><span class="line">       if (layoutState.mAvailable &lt; 0) &#123;</span><br><span class="line">         layoutState.mScrollingOffset += layoutState.mAvailable;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       this.recycleByLayoutState(recycler, layoutState);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     if (stopOnFocusable &amp;&amp; layoutChunkResult.mFocusable) &#123;</span><br><span class="line">       break;</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>其影响到了remainingSpace的值，复写会提升remainingspace的大小，带来的效果就是会在加载完毕限制的viewholder之后在加载一段空间，起到了预加载的地步，但是由于其实际上会造成加载时间增加的问题，因此建议用在例如推荐卡片页，电台自选页面，分类自选页面这种没有分页的页面，写的数值根据各自的情况来定，数值的单位是像素。</p>
<h3 id="复用性提升"><a href="#复用性提升" class="headerlink" title="复用性提升"></a>复用性提升</h3><h4 id="setItemViewCacheSize"><a href="#setItemViewCacheSize" class="headerlink" title="setItemViewCacheSize"></a>setItemViewCacheSize</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setItemViewCacheSize()</span><br></pre></td></tr></table></figure>
<p>使用setItemViewCacheSize,可以在更新viewholder的时候指定复用的viewholder数量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">void updateViewCacheSize() &#123;</span><br><span class="line">     int extraCache = RecyclerView.this.mLayout != null ? RecyclerView.this.mLayout.mPrefetchMaxCountObserved : 0;</span><br><span class="line">     this.mViewCacheMax = this.mRequestedCacheMax + extraCache;</span><br><span class="line"></span><br><span class="line">     for(int i = this.mCachedViews.size() - 1; i &gt;= 0 &amp;&amp; this.mCachedViews.size() &gt; this.mViewCacheMax; --i) &#123;</span><br><span class="line">       this.recycleCachedViewAt(i);</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   void recycleCachedViewAt(int cachedViewIndex) &#123;</span><br><span class="line">     RecyclerView.ViewHolder viewHolder = (RecyclerView.ViewHolder)this.mCachedViews.get(cachedViewIndex);</span><br><span class="line">     this.addViewHolderToRecycledViewPool(viewHolder, true);</span><br><span class="line">     this.mCachedViews.remove(cachedViewIndex);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>其原理如上，我们指定的viewholder数量会影响到将cachedViews的最大数量，而cachedView就是我们刚才看到的视图，如果viewholder一旦被从cachedView移除，进入recyclerpool之中的话，其页面的内容就会被清空，滑回去在希望显示的话，就会出现重新bind，重新绘制，影响效率。</p>
<h4 id="setItemPrefetchEnabled-true"><a href="#setItemPrefetchEnabled-true" class="headerlink" title="setItemPrefetchEnabled(true)"></a>setItemPrefetchEnabled(true)</h4><p>上面updateViewCacheSize中还有一个mPrefetchMaxCountObserved,是recyclerview升级到25.1之后才有的特性<br>其原理<a target="_blank" rel="noopener" href="https://juejin.im/entry/58a3f4f62f301e0069908d8f">数据预取</a><br>总结就是通过将主线程对viewholder的create和bind的操作提前到render画布绘制的过程中进行，以降低主线程卡顿掉帧的时间。这也也算是复用性提升的一点。<br>默认是开启的</p>
<h4 id="setSupportsChangeAnimations-false"><a href="#setSupportsChangeAnimations-false" class="headerlink" title="setSupportsChangeAnimations(false)"></a>setSupportsChangeAnimations(false)</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">((SimpleItemAnimator) rv.getItemAnimator()).setSupportsChangeAnimations(false); </span><br></pre></td></tr></table></figure>

<p>其生效代码为recyclerview.scrapview</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">void scrapView(View view) &#123;</span><br><span class="line">     RecyclerView.ViewHolder holder = RecyclerView.getChildViewHolderInt(view);</span><br><span class="line">     if (!holder.hasAnyOfTheFlags(12) &amp;&amp; holder.isUpdated() &amp;&amp; !RecyclerView.this.canReuseUpdatedViewHolder(holder)) &#123;</span><br><span class="line">       if (this.mChangedScrap == null) &#123;</span><br><span class="line">         this.mChangedScrap = new ArrayList();</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       holder.setScrapContainer(this, true);</span><br><span class="line">       this.mChangedScrap.add(holder);</span><br><span class="line">     &#125; else &#123;</span><br><span class="line">       if (holder.isInvalid() &amp;&amp; !holder.isRemoved() &amp;&amp; !RecyclerView.this.mAdapter.hasStableIds()) &#123;</span><br><span class="line">         throw new IllegalArgumentException(&quot;Called scrap view with an invalid view. Invalid views cannot be reused from scrap, they should rebound from recycler pool.&quot; + RecyclerView.this.exceptionLabel());</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       holder.setScrapContainer(this, false);</span><br><span class="line">       this.mAttachedScrap.add(holder);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>其作用总结为：当更新一个itemview的时候，其更新的步骤最终会走到scrapView这个方法中，这个方法决定是否废弃一个view，如果将其默认的itemanimator关闭的话，则不会废弃这个viewholder，而会继续使用这个viewholder，将其添加到attachscrap中进行数据更新的操作，反之，若没有关闭itemanimator的话，则会创建一个新的viewholder，而将老的viewholder塞入废弃表中。</p>
<h4 id="复用性究极提升，复写RecyclerView-onViewRecycled-holder"><a href="#复用性究极提升，复写RecyclerView-onViewRecycled-holder" class="headerlink" title="复用性究极提升，复写RecyclerView.onViewRecycled(holder)"></a>复用性究极提升，复写RecyclerView.onViewRecycled(holder)</h4><p>通过复写recyclerview.onviewrecycled的方法，可以取到状态变更时新建或者废弃的viewholder，通过我们自己兴建一个共享holder池的方法，可以全局管理我们项目中viewholder的数量。但是这个设计的操作过于复杂，改动的代码过于庞大，大家可以仅做了解。</p>
<h3 id="降低绘制"><a href="#降低绘制" class="headerlink" title="降低绘制"></a>降低绘制</h3><h4 id="填充数据时使用notifyItemXXX而非notifyDataSetChanged"><a href="#填充数据时使用notifyItemXXX而非notifyDataSetChanged" class="headerlink" title="填充数据时使用notifyItemXXX而非notifyDataSetChanged"></a>填充数据时使用notifyItemXXX而非notifyDataSetChanged</h4><p>众所周知，notifyItemXXX是部分刷新，而notifyDataSetChanged则是全部刷新，recyclerview中虽然对全部刷新中在cachedView这张list中的view做了复用处理，但是在部分情况下仍然会出现许多cachedview中的viewholder进入到了Scrap View、recyclerpool、甚至removedview这三张表中，导致刷新的时候走重新bind和重绘的操作。比较明显的是会带来一次闪烁。</p>
<p>因此项目中在刷新部分视图时，多使用notifyItemXXX方法，而非notifydatasetchanged。</p>
<h4 id="setHasFixedSize-true"><a href="#setHasFixedSize-true" class="headerlink" title="setHasFixedSize(true)"></a>setHasFixedSize(true)</h4><p>在item的布局不会动态变化高度和宽度的时候，添加这个方法，可以降低requestlayout的次数</p>
<p>其作用的代码为recyclerview.onmeasure,recyclerview.triggerupdateprocessor</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"> protected void onMeasure(int widthSpec, int heightSpec) &#123;</span><br><span class="line">  if (this.mLayout == null) &#123;</span><br><span class="line">    this.defaultOnMeasure(widthSpec, heightSpec);</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    if (!this.mLayout.isAutoMeasureEnabled()) &#123;</span><br><span class="line">      if (this.mHasFixedSize) &#123;</span><br><span class="line">        this.mLayout.onMeasure(this.mRecycler, this.mState, widthSpec, heightSpec);</span><br><span class="line">        return;</span><br><span class="line">      &#125;</span><br><span class="line">      ....</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void triggerUpdateProcessor() &#123;</span><br><span class="line">    if (RecyclerView.POST_UPDATES_ON_ANIMATION &amp;&amp; RecyclerView.this.mHasFixedSize &amp;&amp; RecyclerView.this.mIsAttached) &#123;</span><br><span class="line">      ViewCompat.postOnAnimation(RecyclerView.this, RecyclerView.this.mUpdateChildViewsRunnable);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      RecyclerView.this.mAdapterUpdateDuringMeasure = true;</span><br><span class="line">      RecyclerView.this.requestLayout();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>其作用点在于将测量过程交与layoutmanager进行，不同的layoutmanager对于测量有自己的优化手段，另外就是在调用notifyItemXXX的时候，不在直接对整个recyclerview进行重绘请求，而是直接执行操作的runnable，调用consumePendingUpdateOperations，最终仅对变动的子item进行重绘，降低了很多重绘的成本。</p>
<p>这个方法发现了一个问题，就是如果仅仅只执行notifyItemXXX的时候，会造成不刷新。主要原因是新增加的数据改变了rv的宽高，导致的问题。因此需要使用这个的时候，在更改数据的时候，需要调用notifydataSetChanged()</p>
<h3 id="针对4-2车机的优化"><a href="#针对4-2车机的优化" class="headerlink" title="针对4.2车机的优化"></a>针对4.2车机的优化</h3><p>4.2的车机，目前接触的是长安车机，其有一个原生的bug，在recyclerview绘制过程中会重复调用resolveRtlPropertiesIfNeeded()最终在canResolveTextDirection()中浪费大量的时间，导致应用十分卡顿但却不会anr，针对这个问题处理的方式是在viewholder中对每一个view执行setLayoutDirection</p>
<p>模版代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">if ( Android.os.Build.VERSION.SDK_INT == Build.VERSION_CODES.JELLY_BEAN_MR1 )&#123;</span><br><span class="line">           helper.getView(R.id.card_bg).setLayoutDirection(View.LAYOUT_DIRECTION_LTR);</span><br><span class="line">           helper.getView(R.id.iv_card_play).setLayoutDirection(View.LAYOUT_DIRECTION_LTR);</span><br><span class="line">           helper.getView(R.id.iv_card_cover).setLayoutDirection(View.LAYOUT_DIRECTION_LTR);</span><br><span class="line">           helper.getView(R.id.tv_card_title).setLayoutDirection(View.LAYOUT_DIRECTION_LTR);</span><br><span class="line">           helper.itemView.setLayoutDirection(View.LAYOUT_DIRECTION_LTR);</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>


<h2 id="布局优化"><a href="#布局优化" class="headerlink" title="布局优化"></a>布局优化</h2><h3 id="使用constraintlayout"><a href="#使用constraintlayout" class="headerlink" title="使用constraintlayout"></a>使用constraintlayout</h3><p>约束布局可以将复杂的布局打散，以达到减少到仅一层布局的地步，使用约束布局仅仅需要固定一个坐标系的原点view，即可生成一套完整的坐标系。<br>了解一下以下的知识点即可以使用约束布局替代任何布局</p>
<h4 id="group：替代contaier的效果，操作一个group，可以将很多视图的可见性绑定起来进行控制"><a href="#group：替代contaier的效果，操作一个group，可以将很多视图的可见性绑定起来进行控制" class="headerlink" title="group：替代contaier的效果，操作一个group，可以将很多视图的可见性绑定起来进行控制"></a>group：替代contaier的效果，操作一个group，可以将很多视图的可见性绑定起来进行控制</h4><p>示例代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;Android.support.constraint.Group</span><br><span class="line">              Android:id=&quot;@+id/container_coupon&quot;</span><br><span class="line">              Android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">              Android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">              app:constraint_referenced_ids=&quot;tv_coupon,bg_coupon&quot;/&gt;</span><br></pre></td></tr></table></figure>

<p>在代码中控制R.id.container_coupon的visiability即可同时控制tv_coupon和bg_coupon的可见性</p>
<p>坑1:使用group控制的view，无法操作自己的可见性，其可见性会被group的可见性覆盖，因此需要将group的粒度控制到最小，确保不会出现一个group的view拥有自己独立的可见性</p>
<p>坑2:使用group控制的view，设置了自己的可见性，立即获取其可见性，此时是设置的可见性，而在下一次重绘之后，则会被覆盖变成group的可见性，业务代码尽量不通过getvisibility()的方式来写业务。</p>
<h4 id="constraintDimensionRatio：可以自由的操作宽高比例"><a href="#constraintDimensionRatio：可以自由的操作宽高比例" class="headerlink" title="constraintDimensionRatio：可以自由的操作宽高比例"></a>constraintDimensionRatio：可以自由的操作宽高比例</h4><p>使用这个后可以完全替代项目中的FixedWidthHeightRatioXXXLayout</p>
<p>其用法为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">app:layout_constraintDimensionRatio=&quot;4:3&quot;</span><br><span class="line"></span><br><span class="line">app:layout_constraintDimensionRatio=&quot;h,4:3&quot;（默认的，不设置为时为H,可以理解为竖屏时的宽高比例）</span><br><span class="line"></span><br><span class="line">app:layout_constraintDimensionRatio=&quot;w,4:3&quot;（这个设置时理解为横屏时的宽高比）</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="chain-替代weight，space，将几个view组合起来平分或者按比例分配竖直或者横向的空间"><a href="#chain-替代weight，space，将几个view组合起来平分或者按比例分配竖直或者横向的空间" class="headerlink" title="chain:替代weight，space，将几个view组合起来平分或者按比例分配竖直或者横向的空间"></a>chain:替代weight，space，将几个view组合起来平分或者按比例分配竖直或者横向的空间</h4><p>在xml视图中切换到视图模式，按住command可以连续选择几个view，然后右键，创建chain，即可使这几个view平分或者设置比例分配视图的空间。</p>
<h4 id="goneMargin-视图属性为gone时，以自己为坐标的视图会额外拥有的margin边距"><a href="#goneMargin-视图属性为gone时，以自己为坐标的视图会额外拥有的margin边距" class="headerlink" title="goneMargin:视图属性为gone时，以自己为坐标的视图会额外拥有的margin边距"></a>goneMargin:视图属性为gone时，以自己为坐标的视图会额外拥有的margin边距</h4><p>这个可以保证即使当前view不存在时，后续视图仍有坐标系可遵循，否则的话后续view将直接以当前view依赖的前置view直接显示自身，会导致布局错乱。</p>
<h4 id="textview设置宽度为0dp，然后设置好startof和endof，即可充足利用一段空间，并且从头开始排布"><a href="#textview设置宽度为0dp，然后设置好startof和endof，即可充足利用一段空间，并且从头开始排布" class="headerlink" title="textview设置宽度为0dp，然后设置好startof和endof，即可充足利用一段空间，并且从头开始排布"></a>textview设置宽度为0dp，然后设置好startof和endof，即可充足利用一段空间，并且从头开始排布</h4><p>这个既可以满足textview的宽度动态变化，又可以保证textview的绘制是从这段空间的起始处开始。</p>
<h3 id="include和merge标签共用"><a href="#include和merge标签共用" class="headerlink" title="include和merge标签共用"></a>include和merge标签共用</h3><p>代码如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;LinearLayout xmlns:Android=&quot;http://schemas.Android.com/apk/res/Android&quot;</span><br><span class="line">    Android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    Android:layout_height=&quot;match_parent&quot;</span><br><span class="line">    Android:orientation=&quot;horizontal&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;include layout=&quot;@layout/A_layout&quot;/&gt;</span><br><span class="line">    &lt;TextView</span><br><span class="line">        Android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        Android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        Android:text=&quot;@string/hello_world&quot; /&gt;</span><br><span class="line"></span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>

<p>其中A_layout可以写为如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;merge xmlns:Android=&quot;http://schemas.Android.com/apk/res/Android&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        Android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        Android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        Android:text=&quot;张三&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        Android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        Android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        Android:text=&quot;李四&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        Android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        Android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        Android:text=&quot;王五&quot; /&gt;</span><br><span class="line"></span><br><span class="line">&lt;/merge&gt;</span><br></pre></td></tr></table></figure>

<p>这样在绘制A_layout时会将这三个textview直接添加到linearlayout中，与helloworld的textview同层级。而往往我们会将A_layout写为有父layout的布局，导致多了一层绘制。</p>
<h3 id="使用viewstub"><a href="#使用viewstub" class="headerlink" title="使用viewstub"></a>使用viewstub</h3><p>在基于业务的场景下，很多复杂的布局在点击或者别的事件触发时才会加载，如果页面过于复杂，使用viewstub比较好。<br>但是viewstub涉及到了一次inflate，inflate是io操作，会导致主线程卡顿，在加载视图十分复杂时使用，简单视图不推荐使用。</p>
<h3 id="去除背景"><a href="#去除背景" class="headerlink" title="去除背景"></a>去除背景</h3><p>imageview如果是没有设置背景，而只设置了src的话，只有一层绘制，但是如果同时设置了背景和src的话，则就产生了两层绘制。</p>
<p>因此尽量不要使用setbackground的操作，设置的话可以通过设置背景为selector，尽可能区分状态，在大部分状态设为透明。</p>
<h1 id="部分工具使用操作"><a href="#部分工具使用操作" class="headerlink" title="部分工具使用操作"></a>部分工具使用操作</h1><h2 id="检测app启动方法耗时"><a href="#检测app启动方法耗时" class="headerlink" title="检测app启动方法耗时"></a>检测app启动方法耗时</h2><p>app启动速度分为冷启动和热启动，冷启动时进程不存在，热启动则相反。</p>
<p>启动方法耗时无法通过traceview实时抓取。仅可通过app自己抓取。</p>
<p>抓取样例</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E5%96%9C%E9%A9%AC%E6%8B%89%E9%9B%85%E8%BD%A6%E8%BD%BD%E7%89%88/" rel="tag"># 喜马拉雅车载版</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2019/09/04/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA-%E4%BD%BF%E7%94%A8idea%E9%80%9A%E8%BF%87hexo%E5%92%8Chugo%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2%E7%9A%84%E4%B8%80%E4%B8%AA%E5%B0%8F%E6%8A%80%E5%B7%A7/" rel="prev" title="博客搭建-使用idea通过hexo和hugo搭建博客的一个小技巧">
                  <i class="fa fa-chevron-left"></i> 博客搭建-使用idea通过hexo和hugo搭建博客的一个小技巧
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2019/12/22/%E5%B7%A5%E4%BD%9C%E5%B0%8F%E7%BB%93-20191222/" rel="next" title="工作小结-2019十二月">
                  工作小结-2019十二月 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">殷鹏程</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>
